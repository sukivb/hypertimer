/**
 * hypertimer.js
 * https://github.com/enmasseio/hypertimer
 *
 * Time control for simulations.
 *
 * Run a timer at a faster or slower pace than real-time, or run discrete events.
 *
 * @version 2.1.3
 * @date    2016-06-23
 *
 * @license
 * Copyright (C) 2014-2015 Almende B.V., http://almende.com
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License. You may obtain a copy
 * of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations under
 * the License.
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("ws"),require("debug")):"function"==typeof define&&define.amd?define(["ws","debug"],e):"object"==typeof exports?exports.hypertimer=e(require("ws"),require("debug")):t.hypertimer=e(t.ws,t.debug)}(this,function(t,e){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){t.exports=n(1)},function(t,e,n){function r(t){function e(){return{paced:w,rate:_,deterministic:b,time:T,master:x,port:O,federateCount:N,bootstrapFederateCount:j}}function n(t){if(A||t.master)for(var e in t)if("master"!==e&&"slave"!==e)throw new Error('Cannot apply configuration option "'+e+'", timer is configured as slave.')}function r(t){function n(t){q.pause()}function o(t){q["continue"]()}function i(t){var n=e();r(t);var o=e();q.emit("config",o,n)}function s(t){f("Removing federate "+t),q.setFederateCount(t-1)}function d(t){f("Adding federate "+t),q.setFederateCount(t)}if("deterministic"in t&&(b=t.deterministic?!0:!1),N="federateCount"in t?t.federateCount:0,"paced"in t&&(w=t.paced?!0:!1),"time"in t&&(S=g(t.time),C=a.systemNow(),l(S),T=new Date(S).toISOString()),"rate"in t){var p=Number(t.rate);if(isNaN(p)||0>=p)throw new TypeError("Invalid rate "+JSON.stringify(t.rate)+". Rate must be a positive number");S=q.now(),C=a.systemNow(),_=p}"bootstrapFederateCount"in t&&(j=t.bootstrapFederateCount),"master"in t&&(A&&(A.destroy(),A=null),x=t.master,null!=t.master&&(A=c(t.master),A.on("change",function(t){i({time:t})}),A.on("config",function(t){i(t)}),A.on("pause",function(t){n(t)}),A.on("continue",function(t){o(t)}),A.on("error",function(t){q.emit("error",t)}))),"port"in t&&(D&&(D.destroy(),D=null),O=t.port,t.port&&(D=u(q.now,q.config,t.port),D.on("federate_on",function(t){d(t)}),D.on("pause",function(t){n(t)}),D.on("federate_gone",function(t){s(t)}),D.on("continue",function(t){o(t)}),D.on("error",function(t){q.emit("error",t)}))),v(),D&&D.broadcastConfig()}function l(t){for(var e=0;e<k.length;e++){var n=k[e];n.type===s.INTERVAL&&d(n,t)}}function d(t,e){t.occurrence=Math.round((e-t.firstTime)/t.interval),t.time=t.firstTime+t.occurrence*t.interval}function p(t){if(k.length>0){for(var e=k.length-1;e>=0&&k[e].time>t.time;)e--;k.splice(e+1,0,t)}else k.push(t)}function h(t,e){function n(){t.type===s.INTERVAL&&I[t.id]&&(t.occurrence++,t.time=t.firstTime+t.occurrence*t.interval,p(t)),delete I[t.id],e&&e()}I[t.id]=t,y("did execute: "+t.annotation,t.time);try{0==t.callback.length?(y("execute synchronous: "+t.annotation,t.time),t.callback(),n()):(y("execute a-synchronous: "+t.annotation,t.time),t.callback(n))}catch(r){i(q,"error")?q.emit("error",r):console.log("Error",r),n()}}function m(t){for(var e=0;e<k.length&&(k[e].time<=t||!isFinite(k[e].time));)e++;var n=k.splice(0,e);return 0==b&&a.shuffle(n),n}function v(){function t(){function t(){var e=r.shift();e?(y("call: "+e.annotation,n),h(e,t)):v()}var e=S;w||(S=n>S&&isFinite(n)?n:S),y("update hyperTime from "+e+" to "+S+" (delta:"+(S-e)+" )",n);var r=m(n);w?(r.forEach(function(t){y("call: "+t.annotation,n),h(t)}),v()):t()}if(w||!(Object.keys(I).length>0)){var e=k[0];if(F&&(clearTimeout(F),F=null),E&&e){var n=e.time,r=n-q.now(),o=w?r/_:0;y("Scheduling timeout: "+e.annotation,n),F=setTimeout(t,Math.round(o))}}}function y(t,e){var n=q.now();"undefined"==typeof e&&(e=n);var r="";e!=n&&(r="offset:"+(n-e)+" exec:"),r+=n,f("(@t "+r+") EVENT TRACE: "+(w?" (paced) ":" (unpaced) ")+t)}function g(t){var e="number"==typeof t?t:t instanceof Date?t.valueOf():new Date(t).valueOf();if(isNaN(e))throw new TypeError("Invalid date "+JSON.stringify(t)+". Date, number, or ISOString expected");return e}f("A timer is instantiated with options: "+JSON.stringify(t));var w=!0,_=1,b=!0,T=null,x=null,O=null,N=0,j=0,E=!1,C=null,S=a.systemNow(),k=[],I={},F=null,R=0,D=null,A=null,q=o({});return q.config=function(t){return t&&(n(t),r(t)),e()},q.now=function(){if(w){if(E){var t=a.systemNow()-C,e=t*_;return S+e}return S}return S},q["continue"]=function(){C=a.systemNow(),f("continued at: "+q.getTime()),q.emit("continue",q.getTime()),E=!0,v()},q.pause=function(){S=q.now(),f("paused at: "+q.getTime()),q.emit("pause",q.getTime()),C=null,E=!1,v()},q.getTime=function(){return new Date(q.now())},q.valueOf=q.getTime,q.toString=function(){return q.getTime().toString()},q.setTimeout=function(t,e,n){var r=R++,o=q.now()+e;if(isNaN(o))throw new TypeError("delay must be a number");var i="undefined"==typeof n?r+" @ "+o:n+" @ "+o;return p({id:r,type:s.TIMEOUT,time:o,callback:t,annotation:i}),v(),r},q.setTrigger=function(t,e,n){var r=R++,o=g(e),i="undefined"==typeof n?r+" @ "+o:n+" @ "+o;return p({id:r,type:s.TRIGGER,time:o,callback:t,annotation:i}),v(),r},q.setInterval=function(t,e,n,r){var o=R++,i=Number(e);if(isNaN(i))throw new TypeError("interval must be a number");(0>i||!isFinite(i))&&(i=0);var u=void 0!=n?g(n):null,c=q.now(),a=null!=u?u:c+i,f="undefined"==typeof r?o+" @ "+a:r+" @ "+a,l={id:o,type:s.INTERVAL,interval:i,time:a,firstTime:null!=u?u:a,occurrence:0,callback:t,annotation:f};return c>a&&d(l,c),p(l),v(),o},q.clearTimeout=function(t){if(I[t])return void delete I[t];for(var e=0;e<k.length;e++)if(k[e].id===t){k.splice(e,1),v();break}},q.clearTrigger=q.clearTimeout,q.clearInterval=q.clearTimeout,q.list=function(){return k.map(function(t){return t.id})},q.clear=function(){I={},k=[],v()},q.destroy=function(){q.emit("beforeDestroy"),q.clear(),A&&A.destroy(),D&&D.destroy(),q.emit("destroy")},q.setFederateCount=function(t){N=t},q.getFederateCount=function(){return N},q.getBootstrapFederateCount=function(){return e().bootstrapFederateCount},Object.defineProperty(q,"running",{get:function(){return E}}),q.config(t),A||q.getBootstrapFederateCount()!=q.getFederateCount()||q["continue"](),q}var o=n(2),i=n(17),u=n(19).createMaster,c=n(35).createSlave,a=n(38),f=n(33)("hypertimer:root"),s={TIMEOUT:0,INTERVAL:1,TRIGGER:2};t.exports=r},function(t,e,n){"use strict";var r,o,i,u,c,a,f,s=n(3),l=n(16),d=Function.prototype.apply,p=Function.prototype.call,h=Object.create,m=Object.defineProperty,v=Object.defineProperties,y=Object.prototype.hasOwnProperty,g={configurable:!0,enumerable:!1,writable:!0};r=function(t,e){var n;return l(e),y.call(this,"__ee__")?n=this.__ee__:(n=g.value=h(null),m(this,"__ee__",g),g.value=null),n[t]?"object"==typeof n[t]?n[t].push(e):n[t]=[n[t],e]:n[t]=e,this},o=function(t,e){var n,o;return l(e),o=this,r.call(this,t,n=function(){i.call(o,t,n),d.call(e,this,arguments)}),n.__eeOnceListener__=e,this},i=function(t,e){var n,r,o,i;if(l(e),!y.call(this,"__ee__"))return this;if(n=this.__ee__,!n[t])return this;if(r=n[t],"object"==typeof r)for(i=0;o=r[i];++i)(o===e||o.__eeOnceListener__===e)&&(2===r.length?n[t]=r[i?0:1]:r.splice(i,1));else(r===e||r.__eeOnceListener__===e)&&delete n[t];return this},u=function(t){var e,n,r,o,i;if(y.call(this,"__ee__")&&(o=this.__ee__[t]))if("object"==typeof o){for(n=arguments.length,i=new Array(n-1),e=1;n>e;++e)i[e-1]=arguments[e];for(o=o.slice(),e=0;r=o[e];++e)d.call(r,this,i)}else switch(arguments.length){case 1:p.call(o,this);break;case 2:p.call(o,this,arguments[1]);break;case 3:p.call(o,this,arguments[1],arguments[2]);break;default:for(n=arguments.length,i=new Array(n-1),e=1;n>e;++e)i[e-1]=arguments[e];d.call(o,this,i)}},c={on:r,once:o,off:i,emit:u},a={on:s(r),once:s(o),off:s(i),emit:s(u)},f=v({},a),t.exports=e=function(t){return null==t?h(f):v(Object(t),a)},e.methods=c},function(t,e,n){"use strict";var r,o=n(4),i=n(11),u=n(12),c=n(13);r=t.exports=function(t,e){var n,r,u,a,f;return arguments.length<2||"string"!=typeof t?(a=e,e=t,t=null):a=arguments[2],null==t?(n=u=!0,r=!1):(n=c.call(t,"c"),r=c.call(t,"e"),u=c.call(t,"w")),f={value:e,configurable:n,enumerable:r,writable:u},a?o(i(a),f):f},r.gs=function(t,e,n){var r,a,f,s;return"string"!=typeof t?(f=n,n=e,e=t,t=null):f=arguments[3],null==e?e=void 0:u(e)?null==n?n=void 0:u(n)||(f=n,n=void 0):(f=e,e=n=void 0),null==t?(r=!0,a=!1):(r=c.call(t,"c"),a=c.call(t,"e")),s={get:e,set:n,configurable:r,enumerable:a},f?o(i(f),s):s}},function(t,e,n){"use strict";t.exports=n(5)()?Object.assign:n(6)},function(t,e){"use strict";t.exports=function(){var t,e=Object.assign;return"function"!=typeof e?!1:(t={foo:"raz"},e(t,{bar:"dwa"},{trzy:"trzy"}),t.foo+t.bar+t.trzy==="razdwatrzy")}},function(t,e,n){"use strict";var r=n(7),o=n(10),i=Math.max;t.exports=function(t,e){var n,u,c,a=i(arguments.length,2);for(t=Object(o(t)),c=function(r){try{t[r]=e[r]}catch(o){n||(n=o)}},u=1;a>u;++u)e=arguments[u],r(e).forEach(c);if(void 0!==n)throw n;return t}},function(t,e,n){"use strict";t.exports=n(8)()?Object.keys:n(9)},function(t,e){"use strict";t.exports=function(){try{return Object.keys("primitive"),!0}catch(t){return!1}}},function(t,e){"use strict";var n=Object.keys;t.exports=function(t){return n(null==t?t:Object(t))}},function(t,e){"use strict";t.exports=function(t){if(null==t)throw new TypeError("Cannot use null or undefined");return t}},function(t,e){"use strict";var n=Array.prototype.forEach,r=Object.create,o=function(t,e){var n;for(n in t)e[n]=t[n]};t.exports=function(t){var e=r(null);return n.call(arguments,function(t){null!=t&&o(Object(t),e)}),e}},function(t,e){"use strict";t.exports=function(t){return"function"==typeof t}},function(t,e,n){"use strict";t.exports=n(14)()?String.prototype.contains:n(15)},function(t,e){"use strict";var n="razdwatrzy";t.exports=function(){return"function"!=typeof n.contains?!1:n.contains("dwa")===!0&&n.contains("foo")===!1}},function(t,e){"use strict";var n=String.prototype.indexOf;t.exports=function(t){return n.call(this,t,arguments[1])>-1}},function(t,e){"use strict";t.exports=function(t){if("function"!=typeof t)throw new TypeError(t+" is not a function");return t}},function(t,e,n){"use strict";var r=n(18),o=n(10),i=Object.prototype.hasOwnProperty;t.exports=function(t){var e;return o(t),e=arguments[1],arguments.length>1?i.call(t,"__ee__")&&Boolean(t.__ee__[e]):t.hasOwnProperty("__ee__")&&!r(t.__ee__)}},function(t,e,n){"use strict";var r=n(10),o=Object.prototype.propertyIsEnumerable;t.exports=function(t){var e;r(t);for(e in t)if(o.call(t,e))return!1;return!0}},function(t,e,n){var r=n(20),o=n(22),i=n(33)("hypertimer:master");e.createMaster=function(t,e,n){function u(){var t=e();return delete t.time,delete t.master,delete t.port,t.federateCount=c.clients.length,t}var c=new r.Server({port:n}),a={},f={};return c.on("connection",function(e){i("new connection"),i("will emit federate on "+u().federateCount),c.emit("federate_on",u().federateCount);var n=o(e);n.on("time",function(e,n){var r=t(),o=e;if(i("timetoken: "+o),"undefined"==typeof f[o]?(c.broadcast("pause",o),f[o]=1):f[o]=f[o]+1,i("federates done: "+f[o]+" of "+u().federateCount),i("queued time "+new Date(r).toISOString()),"undefined"==typeof a[o]?a[o]=[n]:a[o].push(n),f[o]==u().federateCount&&(c.broadcast("continue",o),a[o].length>0)){for(var s=0;s<a[o].length;s++)a[o][s](r),i("send time "+new Date(r).toISOString());delete a[o],delete f[o]}}),e.on("close",function(){i("will emit federate gone "+(u().federateCount+1)),c.emit("federate_gone",u().federateCount+1);for(var t=0;t<c.clients.length;t++)if(c.clients[t]==e){c.clients.splice(t,1);break}}),e.emitter=n,c.broadcastConfig()}),c.broadcastConfig=function(){var t=u();i("send config",t),c.broadcast("config",t)},c.broadcast=function(t,e){i("broadcast",t,e),c.clients.forEach(function(n){n.emitter.send(t,e)}),c.emit(t,e)},c.destroy=function(){c.close(),i("destroyed")},i("listening at ws://localhost:"+n),c}},function(t,e,n){t.exports="undefined"==typeof window||"undefined"==typeof window.WebSocket?n(21):window.WebSocket},function(e,n){e.exports=t},function(t,e,n){var r=n(2),o=n(23),i=n(33)("hypertimer:socket"),u=6e4;t.exports=function(t){function e(e,n){var r={event:e,data:n};i("send",r),t.send(JSON.stringify(r))}function n(e,n){return new o(function(r,o){var a=c();"undefined"==typeof n&&(n=a);var s={event:e,id:a,data:n};f[a]={resolve:r,reject:o,timeout:setTimeout(function(){delete f[a],o(new Error("Timeout"))},u)},i("request",s),t.send(JSON.stringify(s))})["catch"](function(t){console.log("ERROR",t)})}function c(){return s++}var a=r({socket:t,send:e,request:n});t.onmessage=function(e){var n=e.data,r=JSON.parse(n);i("receive",r);var o=f[r.id];o?(clearTimeout(o.timeout),delete f[r.id],o.resolve(r.data)):"id"in r?a.emit(r.event,r.data,function(e){var n={id:r.id,data:e};t.readyState===t.OPEN||t.readyState===t.CONNECTING?(i("reply",n),t.send(JSON.stringify(n))):i("cancel reply",n,"(socket is closed)")}):a.emit(r.event,r.data)};var f={},s=0;return a}},function(t,e,n){t.exports="undefined"==typeof window||"undefined"==typeof window.Promise?n(24):window.Promise},function(t,e,n){"use strict";t.exports=n(25)},function(t,e,n){"use strict";t.exports=n(26),n(28),n(29),n(30),n(31)},function(t,e,n){"use strict";function r(){}function o(t){try{return t.then}catch(e){return v=e,y}}function i(t,e){try{return t(e)}catch(n){return v=n,y}}function u(t,e,n){try{t(e,n)}catch(r){return v=r,y}}function c(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._37=0,this._12=null,this._59=[],t!==r&&h(t,this)}function a(t,e,n){return new t.constructor(function(o,i){var u=new c(r);u.then(o,i),f(t,new p(e,n,u))})}function f(t,e){for(;3===t._37;)t=t._12;return 0===t._37?void t._59.push(e):void m(function(){var n=1===t._37?e.onFulfilled:e.onRejected;if(null===n)return void(1===t._37?s(e.promise,t._12):l(e.promise,t._12));var r=i(n,t._12);r===y?l(e.promise,v):s(e.promise,r)})}function s(t,e){if(e===t)return l(t,new TypeError("A promise cannot be resolved with itself."));if(e&&("object"==typeof e||"function"==typeof e)){var n=o(e);if(n===y)return l(t,v);if(n===t.then&&e instanceof c)return t._37=3,t._12=e,void d(t);if("function"==typeof n)return void h(n.bind(e),t)}t._37=1,t._12=e,d(t)}function l(t,e){t._37=2,t._12=e,d(t)}function d(t){for(var e=0;e<t._59.length;e++)f(t,t._59[e]);t._59=null}function p(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function h(t,e){var n=!1,r=u(t,function(t){n||(n=!0,s(e,t))},function(t){n||(n=!0,l(e,t))});n||r!==y||(n=!0,l(e,v))}var m=n(27),v=null,y={};t.exports=c,c._99=r,c.prototype.then=function(t,e){if(this.constructor!==c)return a(this,t,e);var n=new c(r);return f(this,new p(t,e,n)),n}},function(t,e){(function(e){"use strict";function n(t){c.length||(u(),a=!0),c[c.length]=t}function r(){for(;f<c.length;){var t=f;if(f+=1,c[t].call(),f>s){for(var e=0,n=c.length-f;n>e;e++)c[e]=c[e+f];c.length-=f,f=0}}c.length=0,f=0,a=!1}function o(t){var e=1,n=new l(t),r=document.createTextNode("");return n.observe(r,{characterData:!0}),function(){e=-e,r.data=e}}function i(t){return function(){function e(){clearTimeout(n),clearInterval(r),t()}var n=setTimeout(e,0),r=setInterval(e,50)}}t.exports=n;var u,c=[],a=!1,f=0,s=1024,l=e.MutationObserver||e.WebKitMutationObserver;u="function"==typeof l?o(r):i(r),n.requestFlush=u,n.makeRequestCallFromTimer=i}).call(e,function(){return this}())},function(t,e,n){"use strict";var r=n(26);t.exports=r,r.prototype.done=function(t,e){var n=arguments.length?this.then.apply(this,arguments):this;n.then(null,function(t){setTimeout(function(){throw t},0)})}},function(t,e,n){"use strict";var r=n(26);t.exports=r,r.prototype["finally"]=function(t){return this.then(function(e){return r.resolve(t()).then(function(){return e})},function(e){return r.resolve(t()).then(function(){throw e})})}},function(t,e,n){"use strict";function r(t){var e=new o(o._99);return e._37=1,e._12=t,e}var o=n(26);t.exports=o;var i=r(!0),u=r(!1),c=r(null),a=r(void 0),f=r(0),s=r("");o.resolve=function(t){if(t instanceof o)return t;if(null===t)return c;if(void 0===t)return a;if(t===!0)return i;if(t===!1)return u;if(0===t)return f;if(""===t)return s;if("object"==typeof t||"function"==typeof t)try{var e=t.then;if("function"==typeof e)return new o(e.bind(t))}catch(n){return new o(function(t,e){e(n)})}return r(t)},o.all=function(t){var e=Array.prototype.slice.call(t);return new o(function(t,n){function r(u,c){if(c&&("object"==typeof c||"function"==typeof c)){if(c instanceof o&&c.then===o.prototype.then){for(;3===c._37;)c=c._12;return 1===c._37?r(u,c._12):(2===c._37&&n(c._12),void c.then(function(t){r(u,t)},n))}var a=c.then;if("function"==typeof a){var f=new o(a.bind(c));return void f.then(function(t){r(u,t)},n)}}e[u]=c,0===--i&&t(e)}if(0===e.length)return t([]);for(var i=e.length,u=0;u<e.length;u++)r(u,e[u])})},o.reject=function(t){return new o(function(e,n){n(t)})},o.race=function(t){return new o(function(e,n){t.forEach(function(t){o.resolve(t).then(e,n)})})},o.prototype["catch"]=function(t){return this.then(null,t)}},function(t,e,n){"use strict";var r=n(26),o=n(32);t.exports=r,r.denodeify=function(t,e){return e=e||1/0,function(){var n=this,o=Array.prototype.slice.call(arguments,0,e>0?e:0);return new r(function(e,r){o.push(function(t,n){t?r(t):e(n)});var i=t.apply(n,o);!i||"object"!=typeof i&&"function"!=typeof i||"function"!=typeof i.then||e(i)})}},r.nodeify=function(t){return function(){var e=Array.prototype.slice.call(arguments),n="function"==typeof e[e.length-1]?e.pop():null,i=this;try{return t.apply(this,arguments).nodeify(n,i)}catch(u){if(null===n||"undefined"==typeof n)return new r(function(t,e){e(u)});o(function(){n.call(i,u)})}}},r.prototype.nodeify=function(t,e){return"function"!=typeof t?this:void this.then(function(n){o(function(){t.call(e,null,n)})},function(n){o(function(){t.call(e,n)})})}},function(t,e,n){"use strict";function r(){if(a.length)throw a.shift()}function o(t){var e;e=c.length?c.pop():new i,e.task=t,u(e)}function i(){this.task=null}var u=n(27),c=[],a=[],f=u.makeRequestCallFromTimer(r);t.exports=o,i.prototype.call=function(){try{this.task.call()}catch(t){o.onerror?o.onerror(t):(a.push(t),f())}finally{this.task=null,c[c.length]=this}}},function(t,e,n){var r="undefined"!=typeof window?window.Debug:n(34);t.exports=r||function(){var t=arguments[0];return function(){var e="undefined"==typeof log?console.log:log,n=t+" "+arguments[0];"undefined"!=typeof arguments[1]&&(n+=" "+JSON.stringify(arguments[1])),e(n)}}},function(t,n){t.exports=e},function(t,e,n){var r=n(20),o=n(23),i=n(33)("hypertimer:slave"),u=n(22),c=n(36),a=n(37),f=36e5,s=1e3,l=5;e.createSlave=function(t){function e(){function t(){var t=null;return m?o.resolve(t):n(p).then(function(e){t=e})["catch"](function(t){console.log(t)}).then(function(){return a.wait(s)}).then(function(){return t})}return a.repeat(t,l).then(function(t){i("latencies",t);var e=t.filter(function(t){return null!==t}),n=c.median(e)+c.std(e),r=e.filter(function(t){return n>t});return r.length>0?c.mean(r):null}).then(function(t){return m?o.resolve(null):p.request("time").then(function(e){var n=e+t;return p.emit("change",n),n})})["catch"](function(t){p.emit("error",t)})}function n(t){var e=Date.now();return t.request("time").then(function(n){var r=Date.now(),o=(r-e)/2,i=n+o;return h&&(h=!1,t.emit("change",i)),o})}var d=new r(t),p=u(d),h=!0,m=!1,v=null;return d.onopen=function(){i("connected"),e(),v=setInterval(e,f)},p.destroy=function(){m=!0,clearInterval(v),v=null,d.close(),i("destroyed")},p}},function(t,e){e.compare=function(t,e){return t>e?1:e>t?-1:0},e.add=function(t,e){return t+e},e.sum=function(t){return t.reduce(e.add)},e.mean=function(t){return e.sum(t)/t.length},e.std=function(t){return Math.sqrt(e.variance(t))},e.variance=function(t){if(t.length<2)return 0;var n=e.mean(t);return t.map(function(t){return Math.pow(t-n,2)}).reduce(e.add)/(t.length-1)},e.median=function(t){if(t.length<2)return t[0];var n=t.slice().sort(e.compare);return n.length%2===0?(t[t.length/2-1]+t[t.length/2])/2:t[(t.length-1)/2]}},function(t,e,n){var r=n(23);e.wait=function(t){return new r(function(e){setTimeout(e,t)})},e.repeat=function(t,e){return new r(function(n,r){function o(){e>i?(i++,t().then(function(t){u.push(t),o()})):n(u)}var i=0,u=[];o()})},e.whilst=function(t,e){return new r(function(n,r){function o(){t()?e().then(function(){o()}):n()}o()})}},function(t,e){"function"==typeof Date.now?e.systemNow=function(){return Date.now()}:e.systemNow=function(){return(new Date).valueOf()},e.shuffle=function(t){for(var e,n,r=t.length;r;e=Math.floor(Math.random()*r),n=t[--r],t[r]=t[e],t[e]=n);return t}}])});
//# sourceMappingURL=hypertimer.map